<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOGGA - Shazam de la Mode</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <h1>BOGGA</h1>
        <p>Votre assistant mode personnel</p>
    </header>

    <main>
        <section class="upload-section">
            <h2>Importez une photo de votre tenue</h2>
            <div class="upload-container">
                <input type="file" id="uploadInput" accept="image/*">
                <canvas id="imageCanvas"></canvas>
                <button id="analyzeButton">Analyser l'image</button>
            </div>
        </section>

        <section class="results-section">
            <h2>Articles similaires trouvés</h2>
            <div id="resultsContainer" class="results-container">
                <!-- Les résultats de recherche seront affichés ici -->
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 BOGGA - Shazam de la Mode</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    color: #333;
}

header {
    text-align: center;
    padding: 20px;
    background-color: #4CAF50;
    color: white;
}

header h1 {
    font-size: 3rem;
}

header p {
    font-size: 1.2rem;
}

main {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}

.upload-section {
    text-align: center;
}

.upload-container {
    margin-top: 20px;
}

#uploadInput {
    padding: 10px;
    font-size: 1rem;
}

canvas {
    display: none;
    margin-top: 20px;
    border: 2px solid #4CAF50;
    width: 100%;
    max-width: 400px;
    height: auto;
}

button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 1rem;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
}

button:hover {
    background-color: #45a049;
}

.results-section {
    width: 100%;
    max-width: 800px;
    margin-top: 40px;
}

.results-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
}

.result-item {
    background-color: white;
    border-radius: 8px;
    margin: 10px;
    padding: 20px;
    width: 250px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    text-align: center;
}

.result-item img {
    width: 100%;
    height: auto;
    border-radius: 8px;
}

.result-item h3 {
    margin-top: 10px;
    font-size: 1.1rem;
    color: #4CAF50;
}

.result-item p {
    font-size: 0.9rem;
    color: #666;
}

footer {
    text-align: center;
    margin-top: 40px;
    padding: 10px;
    background-color: #333;
    color: white;
}

document.getElementById('analyzeButton').addEventListener('click', function() {
    const input = document.getElementById('uploadInput');
    const canvas = document.getElementById('imageCanvas');
    const context = canvas.getContext('2d');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                canvas.style.display = 'block';
                canvas.width = img.width;
                canvas.height = img.height;
                context.drawImage(img, 0, 0);

                analyzeImage(canvas); // Analyse l'image après le rendu sur le canvas
            }
            img.src = e.target.result;
        }
        reader.readAsDataURL(input.files[0]);
    }
});

function analyzeImage(canvas) {
    const apiKey = 'AIzaSyA8i0ALg35OzJzM2mnIKTI4z9JeiZUFXcc';  // Remplacez par votre clé d'API Google Cloud Vision
    const imageData = canvas.toDataURL('image/png').split(',')[1];

    fetch(`https://vision.googleapis.com/v1/images:annotate?key=${apiKey}`, {
        method: 'POST',
        body: JSON.stringify({
            requests: [{
                image: { content: imageData },
                features: [{ type: 'LABEL_DETECTION', maxResults: 5 }]
            }]
        }),
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        const labels = data.responses[0].labelAnnotations;
        const searchQuery = labels[0].description;
        fetchSimilarItems(searchQuery);  // Recherche des articles similaires
    })
    .catch(err => console.error('Erreur:', err));
}

function fetchSimilarItems(query) {
    const apiKey = 'caf7996d3cdcb932c1fee0158096b5a284fff403b586b9378b2183382e5550a1';  // Remplacez par votre clé SerpAPI
    const url = `https://serpapi.com/search.json?q=${query}+clothing&tbm=shop&api_key=${apiKey}`;

    fetch(url)
    .then(response => response.json())
    .then(data => {
        const resultsContainer = document.getElementById('resultsContainer');
        resultsContainer.innerHTML = '';

        const items = data.shopping_results;
        items.forEach(item => {
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';

            resultItem.innerHTML = `
                <img src="${item.thumbnail}" alt="${item.title}">
                <h3>${item.source}</h3>
                <p>${item.price}</p>
                <p>${item.material ? item.material : 'Matériau non spécifié'}</p>
            `;
            resultsContainer.appendChild(resultItem);
        });
    })
    .catch(err => console.error('Erreur lors de la recherche des articles:', err));
}
